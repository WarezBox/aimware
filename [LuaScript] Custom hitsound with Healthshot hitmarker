--[[
    Created by: iSun
    Edited by: zack
]]--

hsounds = {"bass.wav", "bf4.wav", "Bowhit.wav", "bruh.wav", "uagay.wav", "rifk.wav", "Cookie.wav", "windows-error.wav", "roblox.mp3", "vitas.wav", "mhit1.mp3", "gachi.wav", "metro2033.mp3", "minecraft.mp3"}
local localplayer, localplayerindex, listen, GetPlayerIndexByUserID, g_curtime = entities.GetLocalPlayer, client.GetLocalPlayerIndex, client.AllowListener, client.GetPlayerIndexByUserID, globals.CurTime
local msc_ref = gui.Reference('MISC', 'GENERAL', 'MAIN')
local allenabled = gui.Checkbox(msc_ref, 'lua_hitsound_enabled', 'Hitsound/marker enabled', 1)
local hsenabled = gui.Checkbox(msc_ref, 'lua_hitsound_enabled', 'Custom hitsound', 1)
local hssounds = gui.Combobox(msc_ref, 'lua_hitsound_combobox', 'Hit', "bass.wav", "bf4.wav", "Bowhit.wav", "bruh.wav", "uagay.wav", "rifk.wav", "Cookie.wav", "windows-error.wav", "roblox.mp3", "vitas.wav", "mhit1.mp3", "gachi.wav", "metro2033.mp3", "minecraft.mp3")
local enabled = gui.Checkbox(msc_ref, 'lua_healthshot_hitmarker_enabled', 'Healthshot hitmarker', 1)
local slider = gui.Slider(msc_ref, 'lua_healthshot_hitmarker_slider', 'Healthshot duration (sec)', 1, 0, 10)
local combo = gui.Combobox(msc_ref, 'lua_healthshot_hitmarker_combobox', 'Healthshot hitmarker', 'On hit', 'On kill')

listen('player_hurt')
listen('player_death')
local function healthshot_hitmarker(e)
 if not allenabled:GetValue() then
  return
 end
 local event_name = e:GetName()
 if event_name ~= 'player_hurt' and event_name ~= 'player_death' then
  return
 end
 local me = localplayerindex()
 local victim = GetPlayerIndexByUserID(e:GetInt('userid'))
 local attacker = GetPlayerIndexByUserID(e:GetInt('attacker'))
 local im_attacker = attacker == me and victim ~= me
 local duration = slider:GetValue()
 if not im_attacker then
  return
 end
 if (combo:GetValue() == 0 and event_name == 'player_hurt') or (combo:GetValue() == 1 and event_name == 'player_death') then
  if enabled:GetValue() then
   localplayer():SetProp('m_flHealthShotBoostExpirationTime', g_curtime() + duration)
  end
 end
 if (event_name == 'player_hurt') then
  if hsenabled:GetValue() then
   local hitcmd = "play " .. hsounds[hssounds:GetValue() + 1];
             client.Command(hitcmd, true);
  end
 end
end
callbacks.Register('FireGameEvent', healthshot_hitmarker)
